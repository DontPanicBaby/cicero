# Установка форума Cicero

Этот документ описывает, как установить форум Cicero. Этот форум написан
на Django (<http://www.djangoproject.com>), и здесь предполагается, что
с самим Django вы уже в общих чертах знакомы.

## Установка "на попробовать"

Форум сделан как подключаемое приложение, а не как самостоятельный
Django-проект. Если у вас еще нет проекта, в который будет подключаться
форум, создайте его обычными средствами Django:

    ./manage.py startproject test_project
    
Шаги собственно установки вполне стандартны:

1.  Скопировать каталог cicero (или поставить symlink) куда-нибудь в 
    питоновский путь (например в site-packages).

2.  Прописать путь к форуму в INSTALLED_APPS:

        INSTALLED_APPS = (
            # стандартные
            'django.contrib.auth',
            'django.contrib.contenttypes',
            'django.contrib.sessions',
            'django.contrib.sites',
            'django.contrib.admin',
            
            'cicero',
        )

3.  Прописать базовый URL форума в проектный urls.py:

        urlpatterns = patterns('',
          (r'^admin/', include('django.contrib.admin.urls')),
          (r'^cicero/', include('cicero.urls')),
        )

4.  Подключить настройки самого Cicero в проектный файл настроек:

        from cicero.settings import *

После этого можно запустить тестовый сервер (`./manage.py runserver`) и
найти форум по адресу <http://localhost:8000/cicero/>.

В этом виде у вас пока не будет работать авторизация, и будет 
использоваться довольно скучный тестовый шаблон.


## Авторизация по OpenID

Форум использует авторизацию по [OpenID][1]. Чтобы она заработала, 
нужно установить несколько библиотек, которых нет в стандартной поставке
Питона:

- py-openid (<http://www.openidenabled.com/openid/libraries/python/>) --
  это библиотека реализующая собственно протокол OpenID

- ElementTree (<http://effbot.org/zone/element-index.htm>), 
  включена в стандартную библиотеку Python 2.5. Очень распространенная
  библиотека для парсинга XML.
  
- BeautifulSoup (<http://www.crummy.com/software/BeautifulSoup/>). Не
  менее распространенная библиотека надежного парсинга HTML.
  
Для включения авторизации потребуется указать две дополнительные 
настройки:

- OPENID_STORE_ROOT -- директория на диске, где будут храниться 
  авторизационные сессии OpenID. Ее, соответственно, надо создать. 
  Только не создавайте ее внутри MEDIA_ROOT, потому что это приватные 
  данные, их не должно быть видно с веба.
  
- Добавить бэкенд аутентификации:

        AUTHENTICATION_BACKENDS = (
          'django.contrib.auth.backends.ModelBackend', # стандартный
          
          'cicero.auth.OpenIdBackend',
        )

Теперь авторизация должна работать.


## Поиск

Для поиска используется сервер Sphinx (<http://www.sphinxsearch.com/>). Его,
соответственно, нужно установить и настроить по его документации. 

Чтобы Sphinx мог индексировать данные форума, надо в его конфигурации 
указать XML-источник данных, который поставляется в Cicero в виде программы 
sphinx_xml.py. Она запускается с одним из двух параметров : 'all' или 
'unread', по которым выдается, соответственно, или полное содержимое базы 
для переиндексации, или только добавленные статьи с момента последней 
полной переиндексации.


## Включение в шаблон

Если форум понравился, его наверняка захочется подключить в основной 
шаблон сайта. Для этого нужно отнаследовать от шаблона сайта (в котором
есть все нужные шапки и прочее) базовый шаблон для Cicero, в котором
определить два блока:

- "cicero_title" -- в нем форум будет писать заголовок окна
- "cicero_content" -- в нем будет содержимое форума

Выглядеть это может например так:

    {% extends "base.html" %}

    {% block my_title %}MySite: {% block cicero_title %}{% endblock %}{% endblock %}

    {% block my_content %}
    {% block cicero_content %}{% endblock %}
    {% endblock %}
    
После этого нужно прописать название этого шаблона в настройку
CICERO_TEMPLATE_BASE.

[1]: http://openid.net/